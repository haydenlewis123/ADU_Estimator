<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Retrieve the saved data from previous steps
        const aduType = JSON.parse(sessionStorage.getItem('adu_type'));
        const aduDetails = JSON.parse(sessionStorage.getItem('aduDetails'));

        // First, check if the required data exists
        if (!aduType || !aduDetails) {
            console.error("Required ADU data not found in session storage.");
            // You could display an error message on the page here
            return;
        }

        const sqftValue = aduDetails.squareFootage; // This will be 'Small', 'Medium', or 'Large'

        let fixedCost = 0;
        let obRange = [0, 0];
        let gcRange = [0, 0];

        // --- NEW, CORRECTED CALCULATION LOGIC ---

        // 1. Determine the Fixed Cost based on ADU Type and Size
        if (aduType === "Garage Conversion" || aduType === "Basement Conversion") {
            fixedCost = 4425;
        } else if (aduType === "Attached ADU" || aduType === "Not Sure Yet") {
            fixedCost = 5625;
        } else if (aduType === "Detached ADU") {
            if (sqftValue === 'Large') {
                fixedCost = 7125;
            } else {
                fixedCost = 5625;
            }
        }

        // 2. Determine Per-Square-Foot Costs based on ADU Type
        if (aduType === "Garage Conversion") {
            obRange = [75, 113];
            gcRange = [113, 188];
        } else if (aduType === "Attached ADU") {
            obRange = [131, 188];
            gcRange = [150, 225];
        } else { 
            // This covers "Detached ADU", "Basement Conversion", and "Not Sure Yet"
            obRange = [131, 188];
            gcRange = [188, 263];
        }

        // --- END OF LOGIC ---

        // Update the page with the calculated values
        document.getElementById("fixedCost").textContent = `$${fixedCost.toLocaleString()}`;
        document.getElementById("monthlyPayment").textContent = Math.round(fixedCost / 6).toLocaleString();
        document.getElementById("obLow").textContent = obRange[0];
        document.getElementById("obHigh").textContent = obRange[1];
        document.getElementById("gcLow").textContent = gcRange[0];
        document.getElementById("gcHigh").textContent = gcRange[1];
    });
</script>
